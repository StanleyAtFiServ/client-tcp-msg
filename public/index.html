<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Write and Send Essay</title>
  <style>
    textarea {
      font-family: monospace;
      width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <h1>Write Your Essay</h1>
  <form id="messageForm">
    <label>
      TCP Port:
      <input type="number" id="portInput" value="30186" required>
    </label>
    <br><br>
    <textarea id="messageInput" placeholder="Write your essay here..." rows="15" required></textarea><br>
    <button type="submit">Send</button>
  </form>

  <script>
    const form = document.getElementById('messageForm');
    const textarea = document.getElementById('messageInput');
    const portInput = document.getElementById('portInput');

    textarea.addEventListener('keydown', function (e) {
      if (e.key === 'Tab') {
        e.preventDefault();
        const start = this.selectionStart;
        const end = this.selectionEnd;
        const value = this.value;
        this.value = value.substring(0, start) + '\t' + value.substring(end);
        this.selectionStart = this.selectionEnd = start + 1;
      }
    });

    form.addEventListener('submit', async function (e) {
        e.preventDefault();
        const message = textarea.value.trim();
        const port = parseInt(portInput.value.trim(), 10);

        if (message && port) {
            try {
                const response = await fetch('/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message, port })
            });
            const result = await response.json();
            
            if (result.status === 'sent') {
                alert(`Response from TCP server:\n${result.response}`);
            } else {
                alert(`Error: ${result.error}`);
            }
            textarea.value = '';
        } catch (err) {
            alert(`Network error: ${err.message}`);
        }
    }
      /*
      if (message && port) {
        const response = await fetch('/send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message, port })
        });
        const result = await response.json();
        alert(`Status: ${result.status}\nMessage: ${result.message || result.error}`);
        textarea.value = '';
      }
        */
    });
  </script>
</body>
</html>
